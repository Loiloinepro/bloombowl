<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pink Data Lab üíñ</title>
  <style>
    :root{
      --bg1:#ffe6f2;
      --bg2:#fff0f7;
      --card:#ffffffcc;
      --text:#3b1c2a;
      --muted:#7a3a55;
      --pink:#ff4fa3;
      --pink2:#ff86c4;
      --line:#ffd1e6;
      --shadow: 0 12px 30px rgba(255,79,163,.18);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% -10%, #fff 0%, transparent 55%),
        radial-gradient(900px 500px at 90% 10%, #fff 0%, transparent 55%),
        linear-gradient(135deg,var(--bg1),var(--bg2));
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px;
    }
    .wrap{width:min(1100px, 100%)}
    header{
      display:flex; align-items:center; justify-content:space-between; gap:16px;
      margin-bottom:14px;
    }
    .title{
      display:flex; align-items:center; gap:12px;
    }
    .badge{
      width:44px; height:44px;
      display:grid; place-items:center;
      border-radius:14px;
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      box-shadow: var(--shadow);
      color:white;
      font-size:22px;
      user-select:none;
    }
    h1{margin:0; font-size:22px; letter-spacing:.2px}
    .subtitle{margin:2px 0 0; color:var(--muted); font-size:13px}
    .pill{
      padding:8px 12px;
      border-radius:999px;
      background:#fff;
      border:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
      box-shadow: 0 8px 20px rgba(255,79,163,.10);
      user-select:none;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:16px;
    }
    @media (max-width: 900px){
      .grid{grid-template-columns:1fr}
    }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding:16px;
    }
    .card h2{
      margin:0 0 10px;
      font-size:16px;
    }
    .muted{color:var(--muted); font-size:13px}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .row > *{flex:1}
    label{display:block; font-size:12px; color:var(--muted); margin:8px 0 6px}
    input, textarea, select{
      width:100%;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#fff;
      color:var(--text);
      outline:none;
    }
    textarea{min-height:88px; resize:vertical}
    input:focus, textarea:focus, select:focus{
      border-color: rgba(255,79,163,.7);
      box-shadow: 0 0 0 4px rgba(255,79,163,.15);
    }

    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    button{
      border:0;
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:600;
      letter-spacing:.2px;
    }
    .primary{
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:white;
      box-shadow: var(--shadow);
    }
    .ghost{
      background:#fff;
      border:1px solid var(--line);
      color:var(--muted);
    }
    .danger{
      background:#fff;
      border:1px solid rgba(255,79,163,.35);
      color:#b21857;
    }

    .stats{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
      margin-top:10px;
    }
    .stat{
      background:#fff;
      border:1px solid var(--line);
      border-radius:16px;
      padding:10px 12px;
    }
    .stat .k{font-size:12px; color:var(--muted)}
    .stat .v{font-size:18px; font-weight:800; margin-top:2px}
    .hr{height:1px; background:var(--line); margin:12px 0}
    canvas{
      width:100%;
      height:240px;
      display:block;
      background:#fff;
      border:1px solid var(--line);
      border-radius:16px;
    }
    .hint{
      font-size:12px;
      color:var(--muted);
      margin-top:10px;
      line-height:1.35;
    }
    .tiny{font-size:11px; color:var(--muted)}
    .toast{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      background:#fff;
      border:1px dashed rgba(255,79,163,.45);
      color:var(--muted);
      display:none;
    }
    .toast.show{display:block}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <div class="badge">üíñ</div>
        <div>
          <h1>Pink Data Lab</h1>
          <div class="subtitle">Mini site pour t‚Äôentra√Æner √† analyser des donn√©es (stat + graphique + export)</div>
        </div>
      </div>
      <div class="pill">Mode girly : ON ‚ú®</div>
    </header>

    <div class="grid">
      <section class="card">
        <h2>1) Entre tes donn√©es</h2>
        <p class="muted">Mets des nombres s√©par√©s par des virgules, espaces ou retours ligne.</p>

        <label for="data">Donn√©es (ex: 12, 15, 9, 22, 18)</label>
        <textarea id="data" placeholder="12, 15, 9, 22, 18"></textarea>

        <div class="row">
          <div>
            <label for="mode">Affichage</label>
            <select id="mode">
              <option value="bars">Graphique : Barres</option>
              <option value="sorted">Trier les valeurs</option>
              <option value="raw">Garder l‚Äôordre saisi</option>
            </select>
          </div>
          <div>
            <label for="bin">Taille de groupe (option)</label>
            <input id="bin" type="number" min="1" step="1" placeholder="ex: 5 (pour regrouper)" />
          </div>
        </div>

        <div class="btns">
          <button class="primary" id="analyze">Analyser üíÖ</button>
          <button class="ghost" id="demo">Mettre un exemple</button>
          <button class="danger" id="clear">Tout effacer</button>
          <button class="ghost" id="export">Exporter CSV</button>
        </div>

        <div class="toast" id="toast"></div>
        <div class="hint">
          Id√©es d‚Äôentra√Ænement :
          <ul>
            <li>Comparer 2 s√©ries (colle une autre liste ‚Üí observe l‚Äôimpact sur moyenne/√©cart-type)</li>
            <li>Ajouter des valeurs extr√™mes (outliers) ‚Üí voir comment √ßa change tout</li>
            <li>Tester un regroupement (taille de groupe) pour lisser le graphe</li>
          </ul>
          <div class="tiny">Astuce: tu peux coller des donn√©es depuis Excel/Sheets, une valeur par ligne.</div>
        </div>
      </section>

      <section class="card">
        <h2>2) R√©sultats</h2>
        <div class="stats" id="stats"></div>

        <div class="hr"></div>

        <h2>3) Graphique</h2>
        <canvas id="chart" width="900" height="360"></canvas>
        <div class="tiny">Le graphe se met √† jour quand tu cliques sur ‚ÄúAnalyser‚Äù.</div>
      </section>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    const els = {
      data: $("data"),
      mode: $("mode"),
      bin: $("bin"),
      analyze: $("analyze"),
      demo: $("demo"),
      clear: $("clear"),
      export: $("export"),
      stats: $("stats"),
      chart: $("chart"),
      toast: $("toast"),
    };

    function showToast(msg){
      els.toast.textContent = msg;
      els.toast.classList.add("show");
      window.clearTimeout(showToast._t);
      showToast._t = window.setTimeout(() => els.toast.classList.remove("show"), 2400);
    }

    function parseNumbers(text){
      // Support: virgule, point-virgule, espace, tab, retour ligne
      const raw = text
        .replace(/;/g, ",")
        .split(/[\s,]+/)
        .map(s => s.trim())
        .filter(Boolean);

      const nums = [];
      for (const s of raw){
        const n = Number(s.replace(",", "."));
        if (Number.isFinite(n)) nums.push(n);
      }
      return nums;
    }

    function mean(arr){
      let sum = 0;
      for (const x of arr) sum += x;
      return sum / arr.length;
    }

    function median(arr){
      const a = [...arr].sort((x,y)=>x-y);
      const mid = Math.floor(a.length/2);
      return a.length % 2 ? a[mid] : (a[mid-1] + a[mid]) / 2;
    }

    function stdev(arr){
      if (arr.length < 2) return 0;
      const m = mean(arr);
      let s2 = 0;
      for (const x of arr) s2 += (x - m) * (x - m);
      // √©cart-type "population" (divis√© par n)
      return Math.sqrt(s2 / arr.length);
    }

    function fmt(n){
      // format court et joli
      if (!Number.isFinite(n)) return "‚Äî";
      const abs = Math.abs(n);
      const digits = abs >= 100 ? 1 : abs >= 10 ? 2 : 3;
      return n.toFixed(digits).replace(/\.0+$/,"").replace(/(\.\d*[1-9])0+$/,"$1");
    }

    function group(arr, size){
      if (!size || size < 2) return arr;
      const out = [];
      for (let i=0;i<arr.length;i+=size){
        const chunk = arr.slice(i, i+size);
        out.push(mean(chunk));
      }
      return out;
    }

    function compute(arr){
      const a = arr;
      const min = Math.min(...a);
      const max = Math.max(...a);
      const m = mean(a);
      const med = median(a);
      const sd = stdev(a);
      return { n: a.length, min, max, mean: m, median: med, stdev: sd, range: max - min };
    }

    function renderStats(s){
      const items = [
        ["N (taille)", s.n],
        ["Min", s.min],
        ["Max", s.max],
        ["√âtendue", s.range],
        ["Moyenne", s.mean],
        ["M√©diane", s.median],
        ["√âcart-type", s.stdev],
      ];
      els.stats.innerHTML = items.map(([k,v]) => `
        <div class="stat">
          <div class="k">${k}</div>
          <div class="v">${fmt(v)}</div>
        </div>
      `).join("");
    }

    function drawBars(values){
      const canvas = els.chart;
      const ctx = canvas.getContext("2d");

      // Clear
      ctx.clearRect(0,0,canvas.width,canvas.height);

      const pad = 28;
      const w = canvas.width;
      const h = canvas.height;
      const innerW = w - pad*2;
      const innerH = h - pad*2;

      // Frame
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0,0,w,h);

      // Soft grid
      ctx.strokeStyle = "rgba(255,79,163,.18)";
      ctx.lineWidth = 1;
      for (let i=0;i<=5;i++){
        const y = pad + (innerH * i/5);
        ctx.beginPath();
        ctx.moveTo(pad, y);
        ctx.lineTo(w-pad, y);
        ctx.stroke();
      }

      if (values.length === 0) return;

      const minV = Math.min(...values);
      const maxV = Math.max(...values);
      const span = (maxV - minV) || 1;

      const barGap = 8;
      const barW = Math.max(10, (innerW - barGap*(values.length-1)) / values.length);

      // Bars (d√©grad√© rose)
      for (let i=0;i<values.length;i++){
        const v = values[i];
        const t = (v - minV) / span;
        const barH = innerH * (0.12 + 0.88 * t); // √©vite barres invisibles
        const x = pad + i*(barW + barGap);
        const y = pad + (innerH - barH);

        const grad = ctx.createLinearGradient(0, y, 0, y+barH);
        grad.addColorStop(0, "#ff4fa3");
        grad.addColorStop(1, "#ffb3d9");

        // shadow
        ctx.fillStyle = "rgba(255,79,163,.18)";
        ctx.fillRect(x+3, y+5, barW, barH);

        // bar
        ctx.fillStyle = grad;
        roundRect(ctx, x, y, barW, barH, 10);
        ctx.fill();

        // label (index)
        ctx.fillStyle = "rgba(59,28,42,.65)";
        ctx.font = "12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
        ctx.textAlign = "center";
        ctx.fillText(String(i+1), x + barW/2, h - 10);
      }

      // Title-ish text
      ctx.fillStyle = "rgba(122,58,85,.9)";
      ctx.font = "14px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.textAlign = "left";
      ctx.fillText("Barres (valeurs ou moyennes de groupes)", pad, 20);
    }

    function roundRect(ctx, x, y, w, h, r){
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x+rr, y);
      ctx.arcTo(x+w, y, x+w, y+h, rr);
      ctx.arcTo(x+w, y+h, x, y+h, rr);
      ctx.arcTo(x, y+h, x, y, rr);
      ctx.arcTo(x, y, x+w, y, rr);
      ctx.closePath();
    }

    function analyze(){
      const nums = parseNumbers(els.data.value);

      if (nums.length === 0){
        els.stats.innerHTML = `<div class="muted">Aucune donn√©e d√©tect√©e. Mets au moins un nombre üíñ</div>`;
        const ctx = els.chart.getContext("2d");
        ctx.clearRect(0,0,els.chart.width,els.chart.height);
        showToast("Ajoute des nombres pour analyser ‚ú®");
        return;
      }

      const mode = els.mode.value;
      let view = [...nums];

      if (mode === "sorted") view.sort((a,b)=>a-b);

      const binSize = Number(els.bin.value);
      const viewGrouped = group(view, Number.isFinite(binSize) ? Math.floor(binSize) : 0);

      renderStats(compute(nums));
      drawBars(viewGrouped);

      showToast(`Analyse OK ‚úÖ  (${nums.length} valeurs)`);
    }

    function setDemo(){
      const demo = [
        12, 15, 9, 22, 18, 17, 14, 13, 25, 16,
        19, 11, 8, 27, 21, 20, 10, 23, 18, 15
      ];
      els.data.value = demo.join(", ");
      els.mode.value = "bars";
      els.bin.value = "";
      analyze();
      showToast("Exemple charg√© üíï");
    }

    function clearAll(){
      els.data.value = "";
      els.bin.value = "";
      els.stats.innerHTML = "";
      const ctx = els.chart.getContext("2d");
      ctx.clearRect(0,0,els.chart.width,els.chart.height);
      showToast("Tout effac√© üßº");
    }

    function exportCSV(){
      const nums = parseNumbers(els.data.value);
      if (nums.length === 0){
        showToast("Rien √† exporter üò∂");
        return;
      }
      const lines = ["index,valeur", ...nums.map((v,i)=>`${i+1},${String(v).replace(".", ",")}`)];
      const blob = new Blob([lines.join("\n")], {type:"text/csv;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "pink-data.csv";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      showToast("CSV export√© üíæ");
    }

    els.analyze.addEventListener("click", analyze);
    els.demo.addEventListener("click", setDemo);
    els.clear.addEventListener("click", clearAll);
    els.export.addEventListener("click", exportCSV);

    // petit bonus: Ctrl/‚åò + Entr√©e pour analyser
    els.data.addEventListener("keydown", (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") analyze();
    });

    // Chargement initial avec un mini exemple
    setDemo();
  </script>
</body>
</html>
